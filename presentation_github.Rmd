---
title: 'R in the Lab: Two Treatments Comparison'
output: github_document
always_allow_html: true
---

A brief R tutorial about how to perform a comparison analysis between two 
treatments data. This is performed through a t-Test, summarizing and graphing the data.  
Note that I didn't explain how I simulated the experimental data, but you can see the code on data_simulation.R  

If you have cloned this repository and want to run this analysis from scratch 
first run erase_all_outputs.R script and then run Main.R script o whichever script 
you want.  

Juan Pablo Carre√≥n Hidalgo  

jpch_26@outlook.com

&nbsp;  

## 1. Problem

You want to know if the consumption of a certain kind of fat can increase drastically the weight. With this purpose you decide to perform an experiment using some mouses. You have twelve animals and you randomly assign a different diet to each one. You will feed six mice with a diet containing the strange fat (diet 1) and the other six will eat a regular diet without any addition (diet 2).  

![Experiment](images/experiment.jpg)

After a week you measure and register the weight of each mouse, So your data look like this:  

```{r import data, echo=FALSE, message=FALSE}
library(kableExtra)
data <- read.csv("data/main_data.csv")

data %>% 
  kbl(caption = "Experimental data", 
      col.names = c("Mouse Code", "Diet", "Weight (g)")) %>% 
  kable_classic_2(full_width = FALSE)
```
Each column on your experimental data should correspond to a different mouse, here represented with a random code. Remember, always be cautious and be sure to assign randomly the treatment to each individual.  

You want to establish if there is a statistical significant difference between the diet treatments. Does the fat in diet 1 increase (or reduce) the mouse weight after a week?  
  
&nbsp;  

## 2. Solution

First, I am assuming that you already know the R basics and, of course, you have installed R already. I am also using RStudio. 

Second, I recommend you to organize your files as follows:

![Files organization](images/files.png)

These folders should be contained in a main folder with a representative name. 

* The analysis folder contains my R scripts, one script for each individual analysis. 
* The data folder contains my data, my experimental data products and my analysis products when their outputs produce text or CSV files.
* The graphs folder contains the graphical outputs produced by their correspond R scripts.  

This organization is not a kind of rule of thumbs. You can organize your files other ways as long as you can ensure the reproducibility and clarity of your analysis.  

Finally, let's perform a Student's t-Test, summarize and make some visual representations of our data.  

&nbsp;  

### 2.1 t-Test  

Basically, a t-Test will compare the diet means taking into account the variation and the sample size of each group. You can perform this analysis following the next code:  

```{r t_test2 code, code = readLines("analysis/t_test2.R")}

```
```{r run t_test2 code, echo=FALSE}
source("analysis/t_test2.R")
```

As can you see, I performed this analysis following three steps: 

* On the first step I imported the experimental data. This file is in CSV (comma-separated values) format and is located on my data folder, so the path that I wrote on this command must contain the folder name.
* On the second step I ran the t-Test properly.
* I saved the analysis result on a file called "t_test_output2.txt" and I stored it on the folder called "data".  

In the function `t.test`, the argument `weight ~ diet` indicates that I want to consider the variable `weight` depended on the variable `diet`. `data = data` indicates that the data is stored in the object called the same way. `alternative = "two.sided"` establish that we want to perform a two-tailed t test, so we are testing for the possibility of the difference between means on both directions (a positive or negative difference). `mu = 0` indicates the true value of the distribution mean and `var.equal = TRUE` indicates that our populations have the same variance.

When you type `t_test`, or open your text file, you'll see your analysis result:  
```{r t_test2 output}
t_test
```

Clearly, this result shows that the diet containing the strange fat (diet 1) increased the weight mice.  

You can type `?t.test` for more information about this function.  

How can you be you sure about the equality of variances (the argument specified as `var.equal = TRUE`)? You can perform the next code:  

```{r f_test code, code = readLines("analysis/f_test.R")}

```
```{r run f_test code, echo=FALSE}
source("analysis/f_test.R")
```

If you type `f_test`, or open your text file, you will see the result:  

```{r f_test output}
f_test
```

What does this mean? Briefly, it means that you can consider both variances equal. If the p-value would have been minor than 0.05, you would have had enough evidence to say that both parameters were different (variances not equal).   

When the variances are not equal, you can correct your code simply by changing `var.equal = TRUE` for `var.equal = FALSE`. The last one is the default value, so you can simply skip it:  

```{r t_test code, code = readLines("analysis/t_test.R")}

```

```{r run t_test code, echo=FALSE}
source("analysis/t_test.R")
```

You can see your results:  

```{r t_test output}
t_test
```

At this example there is no such big difference, but always it is better to be sure so you can reach good conclusions about your results.  

&nbsp;   

### 2.2 Summary  

Next, let's make a summary table with relevant information about our experimental data. It's usual to include the mean and the standard deviation of each one of your treatments, but maybe you want to include more information.  

I'll use the `dplyr` package accomplish this.  

```{r load dplyr, message=FALSE}
library(dplyr)
```

```{r summary, code = readLines("analysis/data_summary.R"), message=FALSE}

```
```{r run summary, echo=FALSE, message=FALSE}
source("analysis/data_summary.R")
```

`group_by()` tells to `summarize()` to perform the operations by grouping by diet. This way, `summarize()` will obtain the statistics we want for each diet. Within this function we specify which operation we want to perform over the response variable (the mice weight).  

I performed this analysis following the same pattern: import your data > make your analysis > save your results. You can skip the first step if you are working on the same session. Personally, I prefer to work on a "modular way" (one script for each analysis), thus I can reproduce or edit an analysis without depending on another one.  

If you save your tables as CSV files, when you edit them to look better, be sure to save it as XLS files or a related one, this way you won't lose your editions. I'm using the `kableExtra` package to write this document, so I can obtain the next table:  

```{r summay output, echo=FALSE}
sum_table %>% 
  kbl(caption = "Data summary",
      col.names = c("Diet", "Min", "Max", "Range", "Mean", 
                    "Median", "SD", "CV (%)")) %>% 
  kable_classic_2(full_width = FALSE)
```

&nbsp;     

### 2.3 Plots  

Finally, let's represent our data by doing a good graph. Frequently this is performed by making a bar graph to represent each treatment mean and its standard deviation as an error bar.  

I'll use `ggplot2` to make this:  

```{r load ggplot2, message=FALSE}
library(ggplot2)
```

I recently found useful to set a global theme that can be applied to each graph. I put this code in a separate script, and run it first:  

```{r global theme, code=readLines("analysis/theme.R")}

```

```{r run global theme}
source("analysis/theme.R")
```

On this chunk of code I just settled the classic theme (`theme_classic()`) and changed the default color and size of `axis.text.x`, `axis.text.y` and  `axis.title`. You can customize your plot themes in multiple ways, but personally I prefer to keep it as simple as possible.  

The next code produces a bar graph using the summary table made in the last section.  

```{r bargraph, code = readLines("analysis/bar_graph.R"), message=FALSE}

```

```{r run bar_graph, echo=FALSE, message=FALSE}
source("analysis/bar_graph.R")
```

I followed the same pattern than in the last sections: import data > make the graph > save the graph.   

`data = sum_table` set where is our data while the code `x = as.factor(diet)` indicates to the functions consider the variable `diet` on the x axis as a categorical variable, not as continuous one. `y = mean` set which variable will be plotted on the y axis (the `mean` column in `sum_table`) . `xlab()` changes the default x axis label, likewise `ylab()` that changes the default y axis label.  

In the last command (`ggsave(bar_graph, filename = "graphs/bargraph.jpeg")`), I saved my plot as a JPEG file on my graphs folder. You can click on it to see the results or type on your console:  

```{r bar_graph output}
bar_graph
```

R and RStudio allow us to be a bit creative and represent our data in other ways. The next code will made a point graph for each diet, with a horizontal blue line representing the median.  

```{r pointgraph, code=readLines("analysis/point_graph.R"), message=FALSE}

```

```{r run point_graph, echo=FALSE, message=FALSE}
source("analysis/point_graph.R")
```

Note that I'm using the original data, not the summary table, so each point represents a mice's weight. Also note that I replaced the `geom_bar()` function by the `geom_point()` one. The function `stat_summary()` will include the median of each treatment as a horizontal blue line. You can specify another statistic with the argument `fun`.  

At the end the code will produce the next graph:   

```{r point_graph output}
point_graph
```

`ggplot2` works like stacking layers, each layer containing a plot element. This enables to combine different types of graphs. The next code combines the  bar and point graphs:  

```{r bar_point_graph, code=readLines("analysis/bar_point_graph.R"), message = FALSE}

```

```{r run bar_point_graph, echo=FALSE, message=FALSE}
source("analysis/bar_point_graph.R")
```

You need to tell to `geom_point()` which data use, otherwise it will use the `summary_table` data specified on the `ggplot()` function.  

```{r bar_point_graph output}
barpoint_graph
```

Maybe it doesn't seem to be a real change, but in some cases bar plots will tend to hide the real distribution of your data. Click the next link to find more information: [#BarBarPlots!](https://thenode.biologists.com/barbarplots/photo/) 

That's it! I think there is no better way to learn than learn by doing. Why don't you try to reproduce all this analysis by yourself? Try to use your own data! You can even clone the repository for this analysis and reproduce it step by step from scratch:   

[Simple Mean Analysis Repository](https://github.com/jpch26/Two-Treatments-Comparison)

Feel free to modify, improve or extend the code. It's all yours!  